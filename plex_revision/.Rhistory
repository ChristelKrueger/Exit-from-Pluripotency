filter(EM_cluster_group == "polycomb P - unmarked PIR" | EM_cluster_group == "bivalent P - poised E" |
EM_cluster_group == "active P - active E" | EM_cluster_group == "inactive P - primed E") %>%
select(interaction_ID, EM_cluster_group, contains("WT"), -contains("DNMT"), -contains("Input"), -contains("ATAC"), -contains("CTCF"),
-contains("mC"), -contains("RNA"), -contains("H3K4me3")) %>%
rename_with(~gsub("CHiC", "P_CHiC", .)) %>%
pivot_longer(3:last_col(), names_to = "sample") %>%
separate(sample, into = c("fragment", "mark", "line", "genotype", "stage", "day")) %>%
select(-line, -genotype, -day) -> SuppFigure4_EM
head(SuppFigure4_EM)
SuppFigure4_EM %>%
filter(mark == "H3K27me3") %>%
filter(EM_cluster_group == "polycomb P - unmarked PIR" | EM_cluster_group == "bivalent P - poised E") %>%
mutate(EM_cluster_group = case_when(EM_cluster_group == "polycomb P - unmarked PIR" ~ "Repressed",
EM_cluster_group == "bivalent P - poised E" ~ "Poised")) %>%
mutate(EM_cluster_group = factor(EM_cluster_group, levels = c("Repressed", "Poised"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("H3K27me3 (log2 RPKM)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ EM_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4c_EM
SuppFigure4c_EM
SuppFigure4_EM %>%
filter(mark == "H3K4me1") %>%
filter(EM_cluster_group == "polycomb P - unmarked PIR" | EM_cluster_group == "bivalent P - poised E") %>%
mutate(EM_cluster_group = case_when(EM_cluster_group == "polycomb P - unmarked PIR" ~ "Repressed",
EM_cluster_group == "bivalent P - poised E" ~ "Poised")) %>%
mutate(EM_cluster_group = factor(EM_cluster_group, levels = c("Repressed", "Poised"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("H3K4me1 (log2 RPKM)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ EM_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4d_EM
SuppFigure4d_EM
SuppFigure4_EM %>%
filter(mark == "CHiC") %>%
filter(EM_cluster_group == "polycomb P - unmarked PIR" | EM_cluster_group == "bivalent P - poised E") %>%
mutate(EM_cluster_group = case_when(EM_cluster_group == "polycomb P - unmarked PIR" ~ "Repressed",
EM_cluster_group == "bivalent P - poised E" ~ "Poised")) %>%
mutate(EM_cluster_group = factor(EM_cluster_group, levels = c("Repressed", "Poised"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("HiC (CHiCAGO)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ EM_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4e_EM
SuppFigure4e_EM
SuppFigure4_EM %>%
filter(mark == "H3K4me1") %>%
filter(EM_cluster_group == "active P - active E" | EM_cluster_group == "inactive P - primed E") %>%
mutate(EM_cluster_group = case_when(EM_cluster_group == "active P - active E" ~ "Active",
EM_cluster_group == "inactive P - primed E" ~ "Primed")) %>%
mutate(EM_cluster_group = factor(EM_cluster_group, levels = c("Primed", "Active"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("H3K4me1 (log2 RPKM)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ EM_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4f_EM
SuppFigure4f_EM
SuppFigure4_EM %>%
filter(mark == "H3K27ac") %>%
filter(EM_cluster_group == "active P - active E" | EM_cluster_group == "inactive P - primed E") %>%
mutate(EM_cluster_group = case_when(EM_cluster_group == "active P - active E" ~ "Active",
EM_cluster_group == "inactive P - primed E" ~ "Primed")) %>%
mutate(EM_cluster_group = factor(EM_cluster_group, levels = c("Primed", "Active"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("H3K27ac (log2 RPKM)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ EM_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4g_EM
SuppFigure4g_EM
SuppFigure4_EM %>%
filter(mark == "CHiC") %>%
filter(EM_cluster_group == "active P - active E" | EM_cluster_group == "inactive P - primed E") %>%
mutate(EM_cluster_group = case_when(EM_cluster_group == "active P - active E" ~ "Active",
EM_cluster_group == "inactive P - primed E" ~ "Primed")) %>%
mutate(EM_cluster_group = factor(EM_cluster_group, levels = c("Primed", "Active"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("HiC (CHiCAGO)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ EM_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4h_EM
SuppFigure4h_EM
ggsave("../output/plots/SuppFigure4c_EM.png", SuppFigure4c_EM, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4c_EM.svg", SuppFigure4c_EM, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4d_EM.png", SuppFigure4d_EM, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4d_EM.svg", SuppFigure4d_EM, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4f_EM.png", SuppFigure4f_EM, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4f_EM.svg", SuppFigure4f_EM, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4g_EM.png", SuppFigure4g_EM, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4g_EM.svg", SuppFigure4g_EM, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4e_EM.png", SuppFigure4e_EM, width = 2.1, height = 2.5, units = "in")
ggsave("../output/plots/SuppFigure4e_EM.svg", SuppFigure4e_EM, width = 2.1, height = 2.5, units = "in")
ggsave("../output/plots/SuppFigure4h_EM.png", SuppFigure4h_EM, width = 2.1, height = 2.5, units = "in")
ggsave("../output/plots/SuppFigure4h_EM.svg", SuppFigure4h_EM, width = 2.1, height = 2.5, units = "in")
magic_table_uncapped %>%
filter(Louvain_cluster_group == "polycomb P - unmarked PIR" | Louvain_cluster_group == "bivalent P - poised E" |
Louvain_cluster_group == "active P - active E" | Louvain_cluster_group == "inactive P - primed E") %>%
select(interaction_ID, Louvain_cluster_group, contains("WT"), -contains("DNMT"), -contains("Input"), -contains("ATAC"), -contains("CTCF"),
-contains("mC"), -contains("RNA"), -contains("H3K4me3")) %>%
rename_with(~gsub("CHiC", "P_CHiC", .)) %>%
pivot_longer(3:last_col(), names_to = "sample") %>%
separate(sample, into = c("fragment", "mark", "line", "genotype", "stage", "day")) %>%
select(-line, -genotype, -day) -> SuppFigure4_Louvain
head(SuppFigure4_Louvain)
SuppFigure4_Louvain %>%
filter(mark == "H3K27me3") %>%
filter(Louvain_cluster_group == "polycomb P - unmarked PIR" | Louvain_cluster_group == "bivalent P - poised E") %>%
mutate(Louvain_cluster_group = case_when(Louvain_cluster_group == "polycomb P - unmarked PIR" ~ "Repressed",
Louvain_cluster_group == "bivalent P - poised E" ~ "Poised")) %>%
mutate(Louvain_cluster_group = factor(Louvain_cluster_group, levels = c("Repressed", "Poised"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("H3K27me3 (log2 RPKM)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ Louvain_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4c_Louvain
SuppFigure4c_Louvain
SuppFigure4_Louvain %>%
filter(mark == "H3K4me1") %>%
filter(Louvain_cluster_group == "polycomb P - unmarked PIR" | Louvain_cluster_group == "bivalent P - poised E") %>%
mutate(Louvain_cluster_group = case_when(Louvain_cluster_group == "polycomb P - unmarked PIR" ~ "Repressed",
Louvain_cluster_group == "bivalent P - poised E" ~ "Poised")) %>%
mutate(Louvain_cluster_group = factor(Louvain_cluster_group, levels = c("Repressed", "Poised"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("H3K4me1 (log2 RPKM)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ Louvain_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4d_Louvain
SuppFigure4d_Louvain
SuppFigure4_Louvain %>%
filter(mark == "CHiC") %>%
filter(Louvain_cluster_group == "polycomb P - unmarked PIR" | Louvain_cluster_group == "bivalent P - poised E") %>%
mutate(Louvain_cluster_group = case_when(Louvain_cluster_group == "polycomb P - unmarked PIR" ~ "Repressed",
Louvain_cluster_group == "bivalent P - poised E" ~ "Poised")) %>%
mutate(Louvain_cluster_group = factor(Louvain_cluster_group, levels = c("Repressed", "Poised"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("HiC (CHiCAGO)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ Louvain_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4e_Louvain
SuppFigure4e_Louvain
SuppFigure4_Louvain %>%
filter(mark == "H3K4me1") %>%
filter(Louvain_cluster_group == "active P - active E" | Louvain_cluster_group == "inactive P - primed E") %>%
mutate(Louvain_cluster_group = case_when(Louvain_cluster_group == "active P - active E" ~ "Active",
Louvain_cluster_group == "inactive P - primed E" ~ "Primed")) %>%
mutate(Louvain_cluster_group = factor(Louvain_cluster_group, levels = c("Primed", "Active"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("H3K4me1 (log2 RPKM)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ Louvain_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4f_Louvain
SuppFigure4f_Louvain
SuppFigure4_Louvain %>%
filter(mark == "H3K27ac") %>%
filter(Louvain_cluster_group == "active P - active E" | Louvain_cluster_group == "inactive P - primed E") %>%
mutate(Louvain_cluster_group = case_when(Louvain_cluster_group == "active P - active E" ~ "Active",
Louvain_cluster_group == "inactive P - primed E" ~ "Primed")) %>%
mutate(Louvain_cluster_group = factor(Louvain_cluster_group, levels = c("Primed", "Active"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("H3K27ac (log2 RPKM)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ Louvain_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4g_Louvain
SuppFigure4g_Louvain
SuppFigure4_Louvain %>%
filter(mark == "CHiC") %>%
filter(Louvain_cluster_group == "active P - active E" | Louvain_cluster_group == "inactive P - primed E") %>%
mutate(Louvain_cluster_group = case_when(Louvain_cluster_group == "active P - active E" ~ "Active",
Louvain_cluster_group == "inactive P - primed E" ~ "Primed")) %>%
mutate(Louvain_cluster_group = factor(Louvain_cluster_group, levels = c("Primed", "Active"))) %>%
mutate(stage = gsub("ES", "ESC", stage)) %>%
mutate(stage = factor(stage, levels = c("ESC", "EpiLC"))) %>%
ggplot(aes(stage, value, fill = stage)) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ylim(0,10) +
ggtitle("HiC (CHiCAGO)") +
scale_fill_manual(values = c(ES_colour, Epi_colour)) +
facet_grid(fragment ~ Louvain_cluster_group) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(size = 8, margin = margin(r=0)),
panel.grid = element_blank(), strip.text.y = element_blank(), strip.background = element_rect(fill = "white", colour = NA),
axis.ticks.x = element_blank(), strip.text = element_text(size = 8), axis.title.y = element_blank(),
axis.text.y = element_text(size = 8), plot.title = element_text(size = 8, hjust = 0.5, vjust = -4)) -> SuppFigure4h_Louvain
SuppFigure4h_Louvain
ggsave("../output/plots/SuppFigure4c_Louvain.png", SuppFigure4c_Louvain, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4c_Louvain.svg", SuppFigure4c_Louvain, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4d_Louvain.png", SuppFigure4d_Louvain, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4d_Louvain.svg", SuppFigure4d_Louvain, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4f_Louvain.png", SuppFigure4f_Louvain, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4f_Louvain.svg", SuppFigure4f_Louvain, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4g_Louvain.png", SuppFigure4g_Louvain, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4g_Louvain.svg", SuppFigure4g_Louvain, width = 2.1, height = 4, units = "in")
ggsave("../output/plots/SuppFigure4e_Louvain.png", SuppFigure4e_Louvain, width = 2.1, height = 2.5, units = "in")
ggsave("../output/plots/SuppFigure4e_Louvain.svg", SuppFigure4e_Louvain, width = 2.1, height = 2.5, units = "in")
ggsave("../output/plots/SuppFigure4h_Louvain.png", SuppFigure4h_Louvain, width = 2.1, height = 2.5, units = "in")
ggsave("../output/plots/SuppFigure4h_Louvain.svg", SuppFigure4h_Louvain, width = 2.1, height = 2.5, units = "in")
source("cluster_analysis_functions.R")
read_tsv("../data/interaction_pairs_uncapped.txt") -> magic_table_uncapped
magic_table_uncapped %>%
filter(EM_cluster_ID == 10 | EM_cluster_ID == 19) %>%
select(interaction_ID, EM_cluster_ID, contains("CTCF")) %>%
select(interaction_ID, EM_cluster_ID, contains("EpiLC_D2")) %>%
pivot_longer(3:last_col(), names_to = "sample", values_to = "log2RPKM") %>%
separate(sample, into = c("fragment", "mark", "line", "genotype", "stage", "day")) %>%
select(-mark, -stage, -day) -> CTCF_EM
head(CTCF_EM)
CTCF_EM %>%
mutate(EM_cluster_ID = case_when(EM_cluster_ID == 10 ~ "cluster 10",
EM_cluster_ID == 19 ~ "cluster 19")) %>%
mutate(line = case_when(line == "DNMT" ~ "Dnmt",
line == "TET" ~ "Tet")) %>%
mutate(genotype = factor(genotype, levels = c("WT", "KO"))) %>%
unite(line, genotype, col = "condition", sep = " ") %>%
mutate(condition = factor(condition, levels = c("Dnmt WT", "Dnmt KO", "", "Tet WT", "Tet KO"))) %>%
ggplot(aes(condition, log2RPKM, fill = condition)) +
ylim(0,10) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ggtitle("EM clustering") +
scale_fill_manual(values = c(DNMT_Epi_WT_colour, DNMT_Epi_KO_colour, TET_Epi_WT_colour, TET_Epi_KO_colour)) +
scale_x_discrete(drop=FALSE) +
facet_grid(fragment ~ EM_cluster_ID) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 10, margin = margin(r=0)),
panel.grid = element_blank(), strip.background = element_rect(fill = "white"), axis.ticks.x = element_blank(), strip.text = element_text(size = 9),
axis.title.y = element_text(size = 12), axis.text.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) -> CTCF_violins_EM
CTCF_violins_EM
magic_table_uncapped %>%
filter(Louvain_cluster_ID == 1 | Louvain_cluster_ID == 19 | Louvain_cluster_ID == 15) %>%
select(interaction_ID, Louvain_cluster_ID, contains("CTCF")) %>%
select(interaction_ID, Louvain_cluster_ID, contains("EpiLC_D2")) %>%
pivot_longer(3:last_col(), names_to = "sample", values_to = "log2RPKM") %>%
separate(sample, into = c("fragment", "mark", "line", "genotype", "stage", "day")) %>%
select(-mark, -stage, -day) -> CTCF_Louvain
head(CTCF_Louvain)
magic_table_uncapped %>%
filter(Louvain_cluster_ID == 1 | Louvain_cluster_ID == 19 | Louvain_cluster_ID == 15) %>%
select(interaction_ID, Louvain_cluster_ID, contains("CTCF")) %>%
select(interaction_ID, Louvain_cluster_ID, contains("EpiLC_D2")) %>%
pivot_longer(3:last_col(), names_to = "sample", values_to = "log2RPKM") %>%
separate(sample, into = c("fragment", "mark", "line", "genotype", "stage", "day")) %>%
select(-mark, -stage, -day) %>%
mutate(Louvain_cluster_ID = case_when(Louvain_cluster_ID == 1 ~ "cluster 1 and 19",
Louvain_cluster_ID == 19 ~ "cluster 1 and 19",
Louvain_cluster_ID == 15 ~ "cluster 15")) %>%
mutate(Louvain_cluster_ID = factor(Louvain_cluster_ID, levels = c("cluster 1 and 19", "cluster 15"))) -> CTCF_Louvain
head(CTCF_Louvain)
CTCF_Louvain %>%
mutate(line = case_when(line == "DNMT" ~ "Dnmt",
line == "TET" ~ "Tet")) %>%
mutate(genotype = factor(genotype, levels = c("WT", "KO"))) %>%
unite(line, genotype, col = "condition", sep = " ") %>%
mutate(condition = factor(condition, levels = c("Dnmt WT", "Dnmt KO", "", "Tet WT", "Tet KO"))) %>%
ggplot(aes(condition, log2RPKM, fill = condition)) +
ylim(0,10) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ggtitle("Louvain clustering") +
scale_fill_manual(values = c(DNMT_Epi_WT_colour, DNMT_Epi_KO_colour, TET_Epi_WT_colour, TET_Epi_KO_colour)) +
scale_x_discrete(drop=FALSE) +
facet_grid(fragment ~ Louvain_cluster_ID) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 10, margin = margin(r=0)),
panel.grid = element_blank(), strip.background = element_rect(fill = "white"), axis.ticks.x = element_blank(), strip.text = element_text(size = 9),
axis.title.y = element_text(size = 12), axis.text.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) -> CTCF_violins_Louvain
CTCF_violins_Louvain
magic_table_uncapped %>%
filter(Louvain_cluster_ID == 1 | Louvain_cluster_ID == 19 | Louvain_cluster_ID == 15) %>%
select(interaction_ID, Louvain_cluster_ID, contains("CTCF")) %>%
select(interaction_ID, Louvain_cluster_ID, contains("EpiLC_D2")) %>%
pivot_longer(3:last_col(), names_to = "sample", values_to = "log2RPKM") %>%
separate(sample, into = c("fragment", "mark", "line", "genotype", "stage", "day")) %>%
select(-mark, -stage, -day) %>%
mutate(Louvain_cluster_ID = case_when(Louvain_cluster_ID == 1 ~ "cluster 1 and 19",
Louvain_cluster_ID == 19 ~ "cluster 1 and 19",
Louvain_cluster_ID == 15 ~ "cluster 15")) %>%
mutate(Louvain_cluster_ID = factor(Louvain_cluster_ID, levels = c("cluster 15", "cluster 1 and 19"))) -> CTCF_Louvain
head(CTCF_Louvain)
CTCF_Louvain %>%
mutate(line = case_when(line == "DNMT" ~ "Dnmt",
line == "TET" ~ "Tet")) %>%
mutate(genotype = factor(genotype, levels = c("WT", "KO"))) %>%
unite(line, genotype, col = "condition", sep = " ") %>%
mutate(condition = factor(condition, levels = c("Dnmt WT", "Dnmt KO", "", "Tet WT", "Tet KO"))) %>%
ggplot(aes(condition, log2RPKM, fill = condition)) +
ylim(0,10) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ggtitle("Louvain clustering") +
scale_fill_manual(values = c(DNMT_Epi_WT_colour, DNMT_Epi_KO_colour, TET_Epi_WT_colour, TET_Epi_KO_colour)) +
scale_x_discrete(drop=FALSE) +
facet_grid(fragment ~ Louvain_cluster_ID) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 10, margin = margin(r=0)),
panel.grid = element_blank(), strip.background = element_rect(fill = "white"), axis.ticks.x = element_blank(), strip.text = element_text(size = 9),
axis.title.y = element_text(size = 12), axis.text.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) -> CTCF_violins_Louvain
CTCF_violins_Louvain
ggsave("../output/plots/SuppFigure5e_EM.png", CTCF_violins_EM, width = 3.5, height = 4, units = "in")
ggsave("../output/plots/SuppFigure5e_EM.svg", CTCF_violins_EM, width = 3.5, height = 4, units = "in")
ggsave("../output/plots/SuppFigure5e_Louvain.png", CTCF_violins_Louvain, width = 3.5, height = 4, units = "in")
ggsave("../output/plots/SuppFigure5e_Louvain.svg", CTCF_violins_Louvain, width = 3.5, height = 4, units = "in")
CTCF_EM %>%
mutate(EM_cluster_ID = case_when(EM_cluster_ID == 10 ~ "cluster 10",
EM_cluster_ID == 19 ~ "cluster 19")) %>%
mutate(line = case_when(line == "DNMT" ~ "Dnmt",
line == "TET" ~ "Tet")) %>%
mutate(genotype = factor(genotype, levels = c("WT", "KO"))) %>%
unite(line, genotype, col = "condition", sep = " ") %>%
mutate(condition = factor(condition, levels = c("Dnmt WT", "Dnmt KO", "", "Tet WT", "Tet KO"))) %>%
ggplot(aes(condition, log2RPKM, fill = condition)) +
ylim(0,10) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ggtitle("EM clustering") +
scale_fill_manual(values = c(DNMT_Epi_WT_colour, DNMT_Epi_KO_colour, TET_Epi_WT_colour, TET_Epi_KO_colour)) +
scale_x_discrete(drop=FALSE) +
facet_grid(fragment ~ EM_cluster_ID) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 10, margin = margin(r=0)),
panel.grid = element_blank(), strip.background = element_rect(fill = "white"), axis.ticks.x = element_blank(), strip.text = element_text(size = 9),
axis.title.y = element_text(size = 12), axis.text.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) -> CTCF_violins_EM
CTCF_violins_EM
CTCF_EM %>%
mutate(EM_cluster_ID = case_when(EM_cluster_ID == 10 ~ "cluster 10",
EM_cluster_ID == 19 ~ "cluster 19")) %>%
mutate(line = case_when(line == "DNMT" ~ "Dnmt",
line == "TET" ~ "Tet")) %>%
mutate(genotype = factor(genotype, levels = c("WT", "KO"))) %>%
unite(line, genotype, col = "condition", sep = " ") %>%
mutate(condition = factor(condition, levels = c("Dnmt WT", "Dnmt KO", "", "Tet WT", "Tet KO"))) %>%
ggplot(aes(condition, log2RPKM, fill = condition)) +
ylim(0,10) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ggtitle("EM clustering") +
scale_fill_manual(values = c(DNMT_Epi_WT_colour, DNMT_Epi_KO_colour, TET_Epi_WT_colour, TET_Epi_KO_colour)) +
scale_x_discrete(drop=FALSE) +
facet_grid(fragment ~ EM_cluster_ID) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 10, margin = margin(r=0)),
panel.grid = element_blank(), strip.background = element_rect(fill = "white"), axis.ticks.x = element_blank(), strip.text = element_text(size = 9),
axis.title.y = element_text(size = 12), axis.text.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) -> CTCF_violins_EM
CTCF_violins_EM
CTCF_Louvain %>%
mutate(line = case_when(line == "DNMT" ~ "Dnmt",
line == "TET" ~ "Tet")) %>%
mutate(genotype = factor(genotype, levels = c("WT", "KO"))) %>%
unite(line, genotype, col = "condition", sep = " ") %>%
mutate(condition = factor(condition, levels = c("Dnmt WT", "Dnmt KO", "", "Tet WT", "Tet KO"))) %>%
ggplot(aes(condition, log2RPKM, fill = condition)) +
ylim(0,10) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ggtitle("Louvain clustering") +
scale_fill_manual(values = c(DNMT_Epi_WT_colour, DNMT_Epi_KO_colour, TET_Epi_WT_colour, TET_Epi_KO_colour)) +
scale_x_discrete(drop=FALSE) +
facet_grid(fragment ~ Louvain_cluster_ID) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 10, margin = margin(r=0)),
panel.grid = element_blank(), strip.background = element_rect(fill = "white"), axis.ticks.x = element_blank(), strip.text = element_text(size = 9),
axis.title.y = element_text(size = 12), axis.text.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) -> CTCF_violins_Louvain
CTCF_violins_Louvain
magic_table_uncapped %>%
filter(Louvain_cluster_ID == 1 | Louvain_cluster_ID == 19 | Louvain_cluster_ID == 15) %>%
select(interaction_ID, Louvain_cluster_ID, contains("CTCF")) %>%
select(interaction_ID, Louvain_cluster_ID, contains("EpiLC_D2")) %>%
pivot_longer(3:last_col(), names_to = "sample", values_to = "log2RPKM") %>%
separate(sample, into = c("fragment", "mark", "line", "genotype", "stage", "day")) %>%
select(-mark, -stage, -day) %>%
mutate(Louvain_cluster_ID = case_when(Louvain_cluster_ID == 1 ~ "cluster 1 and 19",
Louvain_cluster_ID == 19 ~ "cluster 1 and 19",
Louvain_cluster_ID == 15 ~ "cluster 15")) %>%
mutate(Louvain_cluster_ID = factor(Louvain_cluster_ID, levels = c("cluster 15", "cluster 1/19"))) -> CTCF_Louvain
head(CTCF_Louvain)
CTCF_Louvain %>%
mutate(line = case_when(line == "DNMT" ~ "Dnmt",
line == "TET" ~ "Tet")) %>%
mutate(genotype = factor(genotype, levels = c("WT", "KO"))) %>%
unite(line, genotype, col = "condition", sep = " ") %>%
mutate(condition = factor(condition, levels = c("Dnmt WT", "Dnmt KO", "", "Tet WT", "Tet KO"))) %>%
ggplot(aes(condition, log2RPKM, fill = condition)) +
ylim(0,10) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ggtitle("Louvain clustering") +
scale_fill_manual(values = c(DNMT_Epi_WT_colour, DNMT_Epi_KO_colour, TET_Epi_WT_colour, TET_Epi_KO_colour)) +
scale_x_discrete(drop=FALSE) +
facet_grid(fragment ~ Louvain_cluster_ID) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 10, margin = margin(r=0)),
panel.grid = element_blank(), strip.background = element_rect(fill = "white"), axis.ticks.x = element_blank(), strip.text = element_text(size = 9),
axis.title.y = element_text(size = 12), axis.text.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) -> CTCF_violins_Louvain
CTCF_violins_Louvain
magic_table_uncapped %>%
filter(Louvain_cluster_ID == 1 | Louvain_cluster_ID == 19 | Louvain_cluster_ID == 15) %>%
select(interaction_ID, Louvain_cluster_ID, contains("CTCF")) %>%
select(interaction_ID, Louvain_cluster_ID, contains("EpiLC_D2")) %>%
pivot_longer(3:last_col(), names_to = "sample", values_to = "log2RPKM") %>%
separate(sample, into = c("fragment", "mark", "line", "genotype", "stage", "day")) %>%
select(-mark, -stage, -day) %>%
mutate(Louvain_cluster_ID = case_when(Louvain_cluster_ID == 1 ~ "cluster 1/19",
Louvain_cluster_ID == 19 ~ "cluster 1/19",
Louvain_cluster_ID == 15 ~ "cluster 15")) %>%
mutate(Louvain_cluster_ID = factor(Louvain_cluster_ID, levels = c("cluster 15", "cluster 1/19"))) -> CTCF_Louvain
head(CTCF_Louvain)
CTCF_Louvain %>%
mutate(line = case_when(line == "DNMT" ~ "Dnmt",
line == "TET" ~ "Tet")) %>%
mutate(genotype = factor(genotype, levels = c("WT", "KO"))) %>%
unite(line, genotype, col = "condition", sep = " ") %>%
mutate(condition = factor(condition, levels = c("Dnmt WT", "Dnmt KO", "", "Tet WT", "Tet KO"))) %>%
ggplot(aes(condition, log2RPKM, fill = condition)) +
ylim(0,10) +
geom_violin(draw_quantiles = 0.5, scale = "width") +
ggtitle("Louvain clustering") +
scale_fill_manual(values = c(DNMT_Epi_WT_colour, DNMT_Epi_KO_colour, TET_Epi_WT_colour, TET_Epi_KO_colour)) +
scale_x_discrete(drop=FALSE) +
facet_grid(fragment ~ Louvain_cluster_ID) +
theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 10, margin = margin(r=0)),
panel.grid = element_blank(), strip.background = element_rect(fill = "white"), axis.ticks.x = element_blank(), strip.text = element_text(size = 9),
axis.title.y = element_text(size = 12), axis.text.y = element_text(size = 10), plot.title = element_text(size = 12, hjust = 0.5)) -> CTCF_violins_Louvain
CTCF_violins_Louvain
ggsave("../output/plots/SuppFigure5e_EM.png", CTCF_violins_EM, width = 2.8, height = 4, units = "in")
ggsave("../output/plots/SuppFigure5e_EM.svg", CTCF_violins_EM, width = 2.8, height = 4, units = "in")
ggsave("../output/plots/SuppFigure5e_Louvain.png", CTCF_violins_Louvain, width = 2.8, height = 4, units = "in")
ggsave("../output/plots/SuppFigure5e_Louvain.svg", CTCF_violins_Louvain, width = 2.8, height = 4, units = "in")
source("cluster_analysis_functions.R")
read_tsv("../data/interaction_pairs_uncapped.txt") -> magic_table_uncapped
magic_table_uncapped
read_tsv("../data/Annotated Probe Report for DE DNMT Epi WT vs KO no MTC.txt") -> DNMT_WT_vs_KO_import
read_tsv("../data/Annotated Probe Report for DE TET Epi WT vs KO no MTC.txt") -> TET_WT_vs_KO_import
DNMT_WT_vs_KO_import
DNMT_WT_vs_KO_import %>%
select(Probe, DNMT_WT_Epi_2, DNMT_KO_Epi_2) %>%
distinct(Probe, .keep_all = TRUE)
DNMT_WT_vs_KO_import %>%
select(Probe, DNMT_WT_Epi_2, DNMT_KO_Epi_2) %>%
distinct(Probe, .keep_all = TRUE) %>%
mutate(diff_exp = if_else(DNMT_KO_Epi_2 > DNMT_WT_Epi_2, "upregulated", "downregulated"))
DNMT_WT_vs_KO_import %>%
select(Probe, DNMT_WT_Epi_2, DNMT_KO_Epi_2) %>%
distinct(Probe, .keep_all = TRUE) %>%
mutate(diff_exp = if_else(DNMT_KO_Epi_2 > DNMT_WT_Epi_2, "upregulated", "downregulated")) %>%
select(Probe, diff_exp) -> DNMT_diff_genes
TET_WT_vs_KO_import %>%
select(Probe, TET_WT_Epi_2, TET_KO_Epi_2) %>%
distinct(Probe, .keep_all = TRUE) %>%
mutate(diff_exp = if_else(TET_KO_Epi_2 > TET_WT_Epi_2, "upregulated", "downregulated")) %>%
select(Probe, diff_exp) -> TET_diff_genes
magic_table_uncapped %>%
filter(EM_cluster_group == "active P - active E")
